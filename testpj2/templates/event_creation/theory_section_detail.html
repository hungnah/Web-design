{% extends 'base.html' %}

{% block title %}{{ theory_section.title }} - {{ lesson.title }} - Vietnam-Japan Connect{% endblock %}

{% block content %}
<div class="container my-5">
    <!-- Theory Section Header -->
    <div class="row mb-4">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'lessons' %}">Bài học</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'lesson_detail' lesson.id %}">{{ lesson.title }}</a></li>
                    <li class="breadcrumb-item active">{{ theory_section.title }}</li>
                </ol>
            </nav>
            
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <h1 class="mb-3">{{ theory_section.title }}</h1>
                            <p class="lead">{{ theory_section.description }}</p>
                            
                            <div class="mb-3">
                                <span class="badge bg-primary me-2">{{ lesson.get_category_display }}</span>
                                <span class="badge bg-{% if lesson.difficulty == 'beginner' %}success{% elif lesson.difficulty == 'intermediate' %}warning{% else %}danger{% endif %}">
                                    {{ lesson.get_difficulty_display }}
                                </span>
                            </div>
                        </div>
                        <div class="col-md-4 text-center">
                            {% if lesson.image %}
                                <div class="theory-image-container">
                                    <img src="{{ lesson.image.url }}" alt="{{ lesson.title }}" class="theory-image">
                                    <div class="theory-overlay">
                                        <div class="theory-category">
                                            {{ lesson.get_category_display }}
                                        </div>
                                    </div>
                                </div>
                            {% else %}
                                <div class="bg-light rounded d-flex align-items-center justify-content-center" style="height: 200px;">
                                    <i class="fas fa-book-open fa-3x text-muted"></i>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Essential Phrases Section -->
    {% if phrases %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="mb-0">
                            <i class="fas fa-star"></i> Các câu nói cần thiết
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            {% for phrase in phrases %}
                                <div class="col-md-6 mb-3">
                                    <div class="phrase-card h-100 {% if phrase.is_essential %}essential-phrase{% endif %}">
                                        <div class="card {% if phrase.is_essential %}border-warning{% else %}border-light{% endif %}">
                                            <div class="card-body">
                                                {# Chỉ hiển thị Nhật/Anh; ẩn câu tiếng Việt và hướng dẫn phát âm #}
                                                
                                                <div class="translations">
                                                    <div class="row">
                                                        <div class="col-6">
                                                            <strong>Tiếng Nhật:</strong><br>
                                                            <span class="text-muted">{{ phrase.japanese_translation }}</span>
                                                        </div>
                                                        <div class="col-6">
                                                            <strong>Tiếng Anh:</strong><br>
                                                            <span class="text-muted">{{ phrase.english_translation }}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                {# Ẩn ghi chú sử dụng tiếng Việt #}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    <!-- Conversation Examples Section -->
    {% if conversations %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="mb-0">
                            <i class="fas fa-comments"></i> Ví dụ hội thoại thực tế
                        </h3>
                    </div>
                    <div class="card-body">
                        {% for conversation in conversations %}
                            <div class="conversation-example mb-4">
                                <h4 class="text-success mb-3">
                                    <i class="fas fa-play-circle me-2"></i>{{ conversation.title }}
                                </h4>
                                <p class="text-muted mb-3">{{ conversation.description }}</p>
                                
                                <div class="conversation-flow">
                                    {% for line in conversation.lines.all %}
                                        <div class="conversation-line mb-3">
                                            <div class="row align-items-center">
                                                <div class="col-md-2">
                                                    <div class="speaker-badge speaker-{{ line.speaker }}">
                                                        <i class="fas fa-user me-1"></i>
                                                        {% if line.speaker == 'tutor' %}
                                                            TUTOR
                                                        {% elif line.speaker == 'student' %}
                                                            STUDENT
                                                        {% elif line.speaker == 'person_a' %}
                                                            PERSON A
                                                        {% else %}
                                                            PERSON B
                                                        {% endif %}
                                                    </div>
                                                </div>
                                                <div class="col-md-10">
                                                    <div class="speech-bubble speech-{{ line.speaker }}">
                                                        <div class="translations">
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <small class="text-muted">
                                                                        <i class="fas fa-language me-1"></i>{{ line.japanese_translation }}
                                                                    </small>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <small class="text-muted">
                                                                        <i class="fas fa-globe me-1"></i>{{ line.english_translation }}
                                                                    </small>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    <!-- Practice Tips Section -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">
                        <i class="fas fa-lightbulb"></i> Mẹo thực hành
                    </h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h5>Học thuộc:</h5>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success me-2"></i>Học từng câu một cách có hệ thống</li>
                                <li><i class="fas fa-check text-success me-2"></i>Lặp lại nhiều lần để ghi nhớ</li>
                                <li><i class="fas fa-check text-success me-2"></i>Thực hành với người Việt Nam</li>
                                <li><i class="fas fa-check text-success me-2"></i>Ghi âm và so sánh phát âm</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h5>Áp dụng thực tế:</h5>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success me-2"></i>Sử dụng trong cuộc trò chuyện hàng ngày</li>
                                <li><i class="fas fa-check text-success me-2"></i>Thực hành với bạn bè người Việt</li>
                                <li><i class="fas fa-check text-success me-2"></i>Áp dụng khi đi du lịch Việt Nam</li>
                                <li><i class="fas fa-check text-success me-2"></i>Ghi chú và ôn tập thường xuyên</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="alert alert-success mt-3">
                        <i class="fas fa-trophy me-2"></i>
                        <strong>Lời khuyên:</strong> Hãy bắt đầu với những câu nói cần thiết (có nhãn "Cần thiết") trước, 
                        sau đó mở rộng vốn từ vựng với các câu nói khác. Thực hành thường xuyên sẽ giúp bạn tự tin hơn trong giao tiếp!
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.theory-image-container {
    position: relative;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
}

.theory-image-container:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 40px rgba(0,0,0,0.3);
}

.theory-image {
    width: 100%;
    height: 250px;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.theory-image-container:hover .theory-image {
    transform: scale(1.05);
}

.theory-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(0, 123, 255, 0.9), rgba(40, 167, 69, 0.9));
    opacity: 0;
    transition: opacity 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.theory-image-container:hover .theory-overlay {
    opacity: 1;
}

.theory-category {
    background: rgba(255, 255, 255, 0.95);
    color: #007bff;
    padding: 12px 20px;
    border-radius: 25px;
    font-weight: bold;
    font-size: 1rem;
    transform: translateY(20px);
    transition: transform 0.3s ease;
}

.theory-image-container:hover .theory-category {
    transform: translateY(0);
}

.phrase-card {
    transition: all 0.3s ease;
}

.phrase-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.essential-phrase {
    border-left: 4px solid #ffc107 !important;
}

.speaker-badge {
    padding: 8px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: bold;
    text-align: center;
    color: white;
}

.speaker-tutor {
    background: linear-gradient(135deg, #007bff, #0056b3);
}

.speaker-student {
    background: linear-gradient(135deg, #fd7e14, #e55a00);
}

.speaker-person_a {
    background: linear-gradient(135deg, #28a745, #1e7e34);
}

.speaker-person_b {
    background: linear-gradient(135deg, #6f42c1, #5a2d91);
}

.speech-bubble {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 15px;
    border-left: 4px solid #dee2e6;
    position: relative;
}

.speech-tutor {
    border-left-color: #007bff;
    background: linear-gradient(135deg, #f8f9fa, #e3f2fd);
}

.speech-student {
    border-left-color: #fd7e14;
    background: linear-gradient(135deg, #f8f9fa, #fff3e0);
}

.speech-person_a {
    border-left-color: #28a745;
    background: linear-gradient(135deg, #f8f9fa, #e8f5e8);
}

.speech-person_b {
    border-left-color: #6f42c1;
    background: linear-gradient(135deg, #f8f9fa, #f3e5f5);
}

.conversation-line {
    transition: all 0.3s ease;
}

.conversation-line:hover {
    transform: translateX(5px);
}

.card {
    border: none;
    border-radius: 15px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
}

.card:hover {
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
}

.card-header {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    border-bottom: 1px solid #dee2e6;
    border-radius: 15px 15px 0 0 !important;
}
</style>
{% endblock %}
