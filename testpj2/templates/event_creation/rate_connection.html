{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">
                        <i class="fas fa-star text-warning"></i>
                        パートナーに対する満足度を評価してください
                    </h4>
                </div>
                <div class="card-body">
                    <!-- Form đánh giá -->
                    <form method="post">
                        {% csrf_token %}
                        
                        <h5 class="text-warning mb-3">
                            <i class="fas fa-star"></i>
                            あなたの評価
                        </h5>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="rating" class="form-label">
                                        <i class="fas fa-star text-warning"></i>
                                        評価点数 <span class="text-danger">*</span>
                                    </label>
                                    <div class="rating-input">
                                        <div class="stars-container">
                                            {% for i in "12345678910" %}
                                                <input type="radio" 
                                                       name="rating" 
                                                       value="{{ forloop.counter }}" 
                                                       id="star{{ forloop.counter }}" 
                                                       class="star-input" 
                                                       required>
                                                <label for="star{{ forloop.counter }}" class="star-label">
                                                    <i class="far fa-star"></i>
                                                </label>
                                            {% endfor %}
                                        </div>
                                        <div class="rating-text mt-2">
                                            <small class="text-muted">1-10点から選択してください</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="comment" class="form-label">
                                        <i class="fas fa-comment text-info"></i>
                                        コメント
                                    </label>
                                    <textarea class="form-control" 
                                              id="comment" 
                                              name="comment" 
                                              rows="4" 
                                              placeholder="コメントがあればご記入ください (任意)"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Thông báo về hệ thống đánh giá -->
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <strong>注意:</strong> 
                            {% if user_type == 'japanese' %}
                                評価を送信すると、接続は「ベトナム人の評価待ち」状態になります。
                                両方が評価を完了するまで接続は完了しません。
                            {% else %}
                                評価を送信すると、接続は「日本人の評価待ち」状態になります。
                                両方が評価を完了するまで接続は完了しません。
                            {% endif %}
                        </div>
                        
                        <div class="d-flex justify-content-center">
                            <button type="submit" class="btn btn-warning">
                                <i class="fas fa-star"></i>
                                評価を送信
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.rating-input {
    text-align: center;
}

.stars-container {
    display: inline-block;
    position: relative;
}

.star-input {
    display: none;
}

.star-label {
    cursor: pointer;
    font-size: 24px;
    color: #ddd;
    margin: 0 2px;
    transition: color 0.2s;
}

.star-label:hover,
.star-label:hover ~ .star-label,
.star-input:checked ~ .star-label {
    color: #ffc107;
}

.star-input:checked ~ .star-label {
    color: #ffc107;
}

.rating-text {
    font-size: 12px;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Xử lý hiển thị sao khi hover
    const starLabels = document.querySelectorAll('.star-label');
    
    starLabels.forEach((label, index) => {
        label.addEventListener('mouseenter', function() {
            // Reset tất cả sao
            starLabels.forEach(l => l.querySelector('i').className = 'far fa-star');
            
            // Đánh dấu sao từ đầu đến vị trí hiện tại
            for (let i = 0; i <= index; i++) {
                starLabels[i].querySelector('i').className = 'fas fa-star';
            }
        });
        
        label.addEventListener('mouseleave', function() {
            // Reset về trạng thái đã chọn
            const checkedInput = document.querySelector('input[name="rating"]:checked');
            if (checkedInput) {
                const checkedIndex = parseInt(checkedInput.value) - 1;
                starLabels.forEach((l, i) => {
                    l.querySelector('i').className = i <= checkedIndex ? 'fas fa-star' : 'far fa-star';
                });
            } else {
                starLabels.forEach(l => l.querySelector('i').className = 'far fa-star');
            }
        });
        
        label.addEventListener('click', function() {
            // Cập nhật trạng thái sao khi click
            const input = document.getElementById('star' + (index + 1));
            input.checked = true;
            
            starLabels.forEach((l, i) => {
                l.querySelector('i').className = i <= index ? 'fas fa-star' : 'far fa-star';
            });
        });
    });
});
</script>
{% endblock %}
